# 機能仕様書: バイト求人マッチングシステム

**機能ブランチ**: `002-think-hard-ultrathink`
**作成日**: 2025-09-17
**ステータス**: ドラフト
**参考ファイル**: 
specs/001-job-matching-system/20250904_er_complete_v2.0.mmd
specs/001-job-matching-system/answers.md
specs/001-job-matching-system/asks.md
specs/001-job-matching-system/comprehensive_integrated_specification_final_v5.0.md
**入力**: ユーザーの説明: "タイトル: バイト求人マッチングシステム
概要: 毎日10万件の求人から1万人に最適な40件を選定しメール生成
要件:
- 3段階スコアリング（基礎・SEO・パーソナライズ）
- 6セクション構成メール生成
- 30分以内のバッチ処理完了
- リアルタイムSQL実行画面"

## 実行フロー（メイン）
```
1. 入力からユーザーの説明を解析
   → 求人マッチングシステムのコア要件を識別
2. 説明から主要概念を抽出
   → アクター: 求職者（1万人）、システム管理者
   → データ: 求人データ（10万件）、ユーザー応募履歴、SEOキーワード
   → 制約: 30分以内処理、6セクション40件選定
3. スコアリング＆マッチングロジックの定義
   → 3段階スコアリング（基礎・SEO・パーソナライズ）
   → 優先度ベース選定（editorial → top5 → regional → nearby → high_income → new）
4. ユーザーシナリオ＆テストセクションを記入
   → 求職者のメール受信フロー定義
   → バッチ処理の実行シナリオ定義
5. 機能要件を生成
   → 各要件はテスト可能な形式で記述
   → 性能要件を明確化（30分以内、1万人×40件）
6. 主要エンティティを識別
   → 求人、ユーザー、スコア、メールセクション、バッチジョブ
7. レビューチェックリストを実行
   → 機能仕様として完成
8. 戻り値: 成功（仕様は計画の準備完了）
```

---

## ⚡ クイックガイドライン
- ✅ 毎日1万人に最適な求人情報を届ける価値に焦点
- ❌ 実装詳細は別ドキュメント（answers.md）に記載済み
- 👥 求職者と運用チームの両方のニーズを考慮

### セクション要件
- **必須セクション**: すべて記入済み
- **オプションセクション**: 該当なし（すべて必要）
- **統合要件**: specs/001-job-matching-systemの既存仕様を参照

---

## ユーザーシナリオ＆テスト *(必須)*

### 主要ユーザーストーリー
求職者の直己さん（東京都小金井市在住）は、毎朝メールをチェックすると、ゲットバイト通信が届いている。メールを開くと、自分の希望条件（高時給、日払い可、駅近）にマッチした40件の厳選求人が、6つのカテゴリに整理されて表示される。特に「編集部おすすめ」と「あなたにおすすめTOP5」セクションは、過去の応募履歴を考慮してパーソナライズされており、興味のある求人がすぐに見つかる。

### 受け入れシナリオ
1. **前提** 毎朝3:00にバッチ処理開始、**操作** 10万件の求人データをインポート、**結果** 3:30までにデータベースに格納完了
2. **前提** 求人データが格納済み、**操作** 3段階スコアリング実行、**結果** 各求人に基礎・SEO・パーソナライズスコアが付与
3. **前提** スコアリング完了、**操作** 1万人×40件のマッチング実行、**結果** 各ユーザーに最適な40件が選定
4. **前提** マッチング完了、**操作** メール生成処理、**結果** 6:00までに1万通のHTMLメール生成完了
5. **前提** 管理者がモニタリング画面にアクセス、**操作** SQLクエリ実行、**結果** リアルタイムでデータ確認可能

### エッジケース
- データインポートが10万件を超えた場合は？ → 処理を継続し、警告ログを出力
- ユーザーの応募履歴がない新規ユーザーの場合は？ → 基礎スコアとSEOスコアのみで選定
- 特定エリアの求人が40件未満の場合は？ → 隣接エリアから補充、それでも不足なら全国から補充
- バッチ処理が30分を超えそうな場合は？ → 並列処理で高速化、必要に応じて優先度の低いユーザーを翌日に繰り越し
- SQL実行でエラーが発生した場合は？ → エラー詳細を表示し、サンプルクエリを提案

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムは毎日10万件の求人データをCSVから自動インポートしなければならない
- **FR-002**: システムは求人ごとに基礎スコア（時給・fee・企業人気度）を0-100で算出しなければならない
- **FR-003**: システムはSEOキーワードマッチングによるSEOスコアを算出しなければならない
- **FR-004**: システムは協調フィルタリング（implicit ALS）によるパーソナライズスコアを算出しなければならない
- **FR-005**: システムは各ユーザーに対して6セクション構成で合計40件の求人を選定しなければならない
- **FR-006**: システムは選定した求人をHTMLメール形式で生成しなければならない（GPT-5 nano活用）
- **FR-007**: システムは30分以内にすべてのバッチ処理を完了しなければならない
- **FR-008**: システムはリアルタイムSQL実行画面を提供しなければならない
- **FR-009**: システムは2週間以内に応募した企業を除外する重複制御を実施しなければならない
- **FR-010**: システムは14ニーズカテゴリ×12職種への自動分類を実行しなければならない

### 性能要件
- **PR-001**: 10万件のデータインポートを5分以内に完了
- **PR-002**: 1万人分のマッチング処理を20分以内に完了
- **PR-003**: SQLクエリ実行結果を3秒以内に表示
- **PR-004**: メール生成を1人あたり0.1秒以内に完了

### メールセクション構成要件
- **MR-001**: 編集部おすすめ人気バイト（5件）- fee×応募クリック数の上位選定
- **MR-002**: あなたにおすすめ求人TOP5（5件）- パーソナライズスコア上位
- **MR-003**: 都道府県おすすめ求人TOP10（10件）- 地域×職種マッチング
- **MR-004**: 市区町村周辺の求人（8件）- 近隣エリア優先
- **MR-005**: 高収入・日払い求人（7件）- 条件特化型選定
- **MR-006**: 新着求人TOP5（5件）- 7日以内投稿

### 主要エンティティ *(必須)*
- **求人（Job）**: 求人ID、企業コード（endcl_cd）、職種、時給、勤務地、fee、投稿日時を持つ求人情報
- **ユーザー（User）**: ユーザーID、メールアドレス、推定居住地（応募履歴から推定）、応募履歴を持つ求職者
- **スコア（Score）**: 求人ID、基礎スコア、SEOスコア、パーソナライズスコア、総合スコアを持つ評価データ
- **メールセクション（EmailSection）**: セクション種別、選定求人リスト、優先順位を持つメール構成要素
- **バッチジョブ（BatchJob）**: ジョブID、開始時刻、終了時刻、処理ステータス、エラーログを持つ処理記録
- **企業人気度（CompanyPopularity）**: 企業コード、360日応募数、360日閲覧数、応募率を持つ統計データ

---

## レビュー＆承認チェックリスト

### コンテンツ品質
- [x] 実装の詳細なし（実装詳細はanswers.mdに分離）
- [x] ユーザー価値とビジネスニーズに焦点を当てる
- [x] 非技術的な関係者向けに書かれている
- [x] すべての必須セクションが完了

### 要件の完全性
- [x] [要確認]マーカーが残っていない
- [x] 要件はテスト可能で明確
- [x] 成功基準は測定可能（30分以内、1万人×40件）
- [x] スコープが明確に境界付けられている
- [x] 依存関係と仮定が識別されている（既存仕様書との統合）

---

## 実行ステータス

- [x] ユーザーの説明を解析
- [x] 主要概念を抽出
- [x] 実装済み仕様を参照
- [x] ユーザーシナリオを定義
- [x] 要件を生成
- [x] エンティティを識別
- [x] レビューチェックリストに合格

---