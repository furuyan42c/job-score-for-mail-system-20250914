# バイト求人マッチングシステム ビジネス仕様書

## 1. システム概要

### 1.1 サービス概要
本システムは、10万件のバイト求人データベースから、1万人の会員それぞれに最適な40件を毎日自動選定し、パーソナライズされたメールを配信するマッチングサービスです。

### 1.2 ビジネス目標
- **応募率向上**: パーソナライズ配信により応募率30%向上を目指す
- **配信効率化**: 1万通/日の完全自動配信を実現
- **継続率向上**: 的確なマッチングによる配信停止率の低減

### 1.3 システムの特徴
1. **データドリブンなスコアリング**: SEMRushキーワードデータ（LLM拡張済み）と求人特徴の複合評価
2. **行動ベースのパーソナライゼーション**: 応募履歴から好みを学習
3. **多様性確保**: 偏りのない40件の選定
4. **LLM活用**: キーワード拡張（手動実行）とメール文面の自動生成

## 2. 配信メール構成

### 2.1 配信スケジュール
- **配信時刻**: 毎朝6:00
- **配信頻度**: 1日1回（ユーザー設定により週次も可能）
- **配信件数**: 1ユーザーあたり40件の求人情報

### 2.2 メール構成要素

#### メールヘッダー
- 配信日付
- ユーザー名（応募時の登録名）
- 活動エリア（応募履歴から推定）

#### 本文セクション
1. **おすすめ求人TOP5**（詳細表示）
   - 時給、勤務時間、特典を強調
   - ワンクリック応募リンク付き

2. **エリア別求人TOP10**
   - 応募頻度の高い都道府県の求人

3. **近隣求人TOP10**
   - 応募頻度の高い市区町村の求人

4. **お得バイトTOP10**
   - 日払い、高時給などの特典求人

### 2.3 配信文面サンプル
```
━━━━━━━━━━━━━━━━━━━━━━━━
📧 ゲットバイト通信　2025年7月15日号
━━━━━━━━━━━━━━━━━━━━━━━━
※本メールは「ゲットバイト」にご登録の
直己 様（東京都小金井市エリアで活動中）にお届けしています。

こんにちは、ゲットバイト編集部です！
本日の超おすすめ40求人をお届けします。
```

## 3. データベース構造

### 3.1 主要データグループ

#### マスターデータ
- 都道府県・市区町村マスター（位置情報付き）
- 隣接市区町村マスター（主要都市の隣接関係）
- 職種分類マスター（大中小分類）
- 雇用形態マスター（アルバイト、パート等）
- 給与タイプマスター（時給、日給、月給等）
- 求人特徴マスター（未経験歓迎等の条件）
- ニーズカテゴリーマスター（14種類）

#### 求人データ
- 求人詳細情報（385項目）
- マッチング用軽量データ
- 表示用コンテンツデータ
- スコアリング結果データ

#### キーワード・スコアリング
- SEMRushキーワードデータ（検索ボリューム、競合度）
- LLM拡張済みキーワード（手動更新・月次程度）
- スコアリングルール定義
- カテゴリー別重み設定

#### ユーザー関連
- ユーザー基本情報
- ユーザープロファイル（応募傾向の自動集計）
- 行動履歴（開封、クリック、応募）
- ユーザー×求人マッピング

#### 配信管理
- 日次選定求人リスト
- メール配信キュー
- 配信ステータス管理

## 4. カテゴリー分類システム

### 4.1 ニーズベースカテゴリー（14種類）

求人は以下のニーズカテゴリーに自動分類され、複数のカテゴリーに属することが可能です。

| カテゴリー名 | 対象者 | 判定方法 |
|------------|---------|----------|
| 日払い・週払い | すぐに給料が必要な人 | キーワード自動検出 |
| 短期・単発OK | 短期間だけ働きたい人 | キーワード＋雇用期間 |
| 高時給 | 効率よく稼ぎたい人 | 地域平均の120%以上 |
| シフト自由 | 自分のペースで働きたい人 | キーワード検出 |
| 未経験歓迎 | 初めてバイトする人 | 特徴コード＋キーワード |
| 在宅・リモート | 通勤したくない人 | キーワード検出 |
| 学生歓迎 | 学業と両立したい人 | 特徴コード |
| 高校生歓迎 | 高校生 | 年齢条件＋キーワード |
| 主婦歓迎 | 家事・育児と両立したい人 | キーワード検出 |
| シニア歓迎 | 60歳以上の人 | キーワード検出 |
| 土日のみOK | 週末だけ働きたい人 | キーワード検出 |
| 副業・WワークOK | 掛け持ちしたい人 | キーワード検出 |
| 交通費支給 | 交通費を節約したい人 | キーワード検出 |
| 即日勤務OK | すぐに働きたい人 | キーワード検出 |

### 4.2 職種カテゴリー（12種類）

各求人は1つの職種カテゴリーに分類されます。

- 飲食・フード系（ホール、キッチン、カフェ等）
- 販売・サービス系（アパレル、コンビニ、スーパー等）
- 配送・ドライバー系（宅配、デリバリー等）
- オフィスワーク系（事務、データ入力等）
- 医療・介護・保育系
- 軽作業・工場系
- 美容・理容系
- 教育系（塾講師、家庭教師等）
- エンタメ系
- イベント・キャンペーン系
- IT・クリエイティブ系
- その他

### 4.3 カテゴリー分類の改善機能

#### 検索精度向上
- 9つのデータフィールドから総合判定
- 否定パターンの自動除外（「日払い不可」等を除外）
- 複合条件での判定（主婦歓迎＝キーワード＋勤務時間帯）

#### 信頼度スコア
- 各カテゴリーマッチの確からしさを0-100で評価
- キーワード出現位置、回数、関連データでの裏付けを考慮

## 5. スコアリングシステム

### 5.1 基本スコアの構成（0-999,999点）

求人の魅力度を以下の6要素で総合評価します。

| 評価要素 | 配分 | 評価内容 |
|---------|------|----------|
| キーワードマッチ | 35% | LLM拡張済みSEMRushキーワードとのマッチング※ |
| 求人特徴 | 25% | 未経験歓迎、交通費支給等の人気条件 |
| 給与競争力 | 20% | 地域・職種別の相対的な給与水準 |
| 掲載新鮮度 | 10% | 新着求人や締切までの期間 |
| 立地利便性 | 5% | 駅からの距離、主要駅かどうか |
| 企業評価 | 5% | 過去の応募実績、掲載頻度 |

※キーワード拡張：「コンビニ バイト」→「コンビニ」「バイト」「セブン」「ファミマ」「ローソン」等に拡張。月1回程度、運用担当者が手動でLLMを使用して更新。

### 5.2 カテゴリー別ブースト係数

需要の高いカテゴリーにはスコアブーストを適用：

- **高時給**: 1.5倍
- **在宅・リモート**: 1.4倍
- **配送・ドライバー系**: 1.3倍
- **日払い・週払い**: 1.3倍
- **医療・介護・保育系**: 1.4倍

## 6. 隣接市区町村機能

### 6.1 概要
ユーザーの活動エリアから通勤可能な範囲の求人を提供するため、隣接市区町村の関係をマスターデータとして管理します。

### 6.2 隣接市区町村マスター

#### データ構造
| フィールド | 説明 | 例 |
|----------|------|-----|
| city_cd | 市区町村コード | 13113（渋谷区） |
| adjacent_city_cd | 隣接市区町村コード | 13109（世田谷区） |
| distance_km | 参考距離（km） | 2.5 |

#### 対象範囲
- **東京23区**: 全区間の隣接関係（約150レコード）
- **政令指定都市**: 主要区間の隣接関係（約200レコード）
- **その他主要都市**: 隣接する主要市のみ（約100レコード）
- **合計**: 約500レコード程度

### 6.3 エリア判定ロジック

#### 優先順位
1. **レベル1（同一市区町村）**: 重み 1.0
   - ユーザーが応募した市区町村と完全一致
   
2. **レベル2（隣接市区町村）**: 重み 0.7
   - 隣接市区町村マスターに定義された隣接エリア
   - 電車で1-2駅程度の距離
   
3. **レベル3（同一都道府県）**: 重み 0.4
   - 隣接データがない場合のフォールバック
   - 同じ都道府県内の求人

### 6.4 実装方針
- 事前定義した静的マスターデータを使用（動的計算は行わない）
- 主要都市のみカバー（全体の約20%）
- データがない地域は都道府県レベルでマッチング
- 年1回程度のマスター更新で運用

## 7. パーソナライゼーション

### 7.1 ユーザープロファイリング

**応募履歴からの自動学習**
- 最初の1件の応募から配信開始
- 応募のたびに精度が向上
- 居住地情報は取得せず、応募エリアから推定

**学習する要素**
- 活動エリア（都道府県・市区町村）
- 希望職種
- 希望給与レンジ
- 重視する条件（日払い、シフト自由等）

### 7.2 パーソナライズドスコア

基本スコアをユーザーの好みで調整（最大2倍）：

| マッチ要素 | 影響度 | 判定方法 |
|-----------|--------|----------|
| 地域マッチ | 40% | 同一・隣接・同一県の3段階評価 |
| 職種マッチ | 30% | 過去の応募職種との一致 |
| 給与マッチ | 15% | 応募実績の給与帯との適合 |
| 特徴マッチ | 10% | 重視する条件との一致 |
| カテゴリーマッチ | 5% | 好みのカテゴリーとの一致 |

※地域マッチは隣接市区町村マスターを活用して判定

### 7.3 フィルタリング機能

#### 除外ルール
- 3回以上応募して不採用の企業
- 配信しても一度も開封しないカテゴリー

#### 多様性の確保
選定される40件の内訳制限：
- 同一カテゴリー：最大10件
- 同一職種：最大15件
- 同一地域：最大20件
- 上位10件は制限なし（高スコア優先）

## 8. システム処理フロー

### 8.1 日次バッチ処理スケジュール

| 時刻 | 処理名 | 処理内容 | 目標時間 |
|------|--------|----------|---------|
| 02:00 | データ収集 | 外部APIから求人データ取得・更新 | 30分 |
| 03:00 | スコアリング | 全求人のスコア計算・カテゴリー分類 | 45分 |
| 04:00 | マッチング | 1万ユーザー×40件の選定 | 60分 |
| 05:00 | メール生成 | LLMによる文面生成・キュー登録 | 30分 |
| 06:00 | 配信実行 | SendGrid/SES経由での一斉配信 | 120分 |

### 8.2 手動実行処理（月次・随時）

| 頻度 | 処理名 | 処理内容 | 実行者 |
|------|--------|----------|--------|
| 月1回 | キーワード拡張 | SEMRushキーワードのLLM分析・拡張 | 運用担当者 |
| 随時 | カテゴリー調整 | ニーズカテゴリーのルール更新 | 運用担当者 |
| 年1回 | 隣接マスター更新 | 隣接市区町村関係の見直し | 運用担当者 |
| 週1回 | 品質チェック | スコアリング結果の妥当性確認 | 運用担当者 |

### 8.3 データ更新処理

- **応募データ**: 日次バッチでユーザープロファイルを更新
- **開封・クリック記録**: ログファイルに記録（日次集計）
- **配信停止**: 次回配信時に反映

## 9. システム構成

### 9.1 ディレクトリ構造
```
new.mail.score/
├── specs/                      # 仕様書
│   ├── ER/                     # ER図
│   │   └── ER_new_modified.mmd # データベース設計図
│   ├── specification.md        # 元仕様書
│   ├── system_specification_v2.md # 技術仕様書
│   └── business_specification.md  # 本ビジネス仕様書
│
├── src/                        # ソースコード
│   ├── batch/                  # バッチ処理
│   │   ├── batch_01_import_jobs.py
│   │   ├── batch_02_scoring.py
│   │   ├── batch_03_matching.py
│   │   ├── batch_04_email_generation.py
│   │   └── batch_05_send_emails.py
│   │
│   ├── api/                    # API実装
│   │   ├── scoring/            # スコアリングAPI
│   │   ├── matching/           # マッチングAPI
│   │   └── webhook/            # Webhook処理
│   │
│   ├── models/                 # データモデル
│   │   ├── job.py              # 求人モデル
│   │   ├── user.py             # ユーザーモデル
│   │   └── enrichment.py       # エンリッチメントモデル
│   │
│   ├── services/               # ビジネスロジック
│   │   ├── categorization/     # カテゴリー分類
│   │   ├── scoring/            # スコアリング
│   │   ├── personalization/    # パーソナライゼーション
│   │   └── email_generation/   # メール生成
│   │
│   └── utils/                  # ユーティリティ
│       ├── database.py         # DB接続
│       ├── cache.py            # キャッシュ管理
│       └── logger.py           # ログ出力
│
├── config/                     # 設定ファイル
│   ├── .env.development        # 開発環境設定
│   ├── .env.production         # 本番環境設定
│   └── categories.yaml         # カテゴリー定義
│
├── tests/                      # テスト
│   ├── unit/                   # 単体テスト
│   ├── integration/            # 統合テスト
│   └── fixtures/               # テストデータ
│
├── migrations/                 # データベースマイグレーション
│   └── sql/                    # SQLスクリプト
│
├── logs/                       # ログファイル
│
├── docker/                     # Docker設定
│   ├── Dockerfile
│   └── docker-compose.yml
│
└── README.md                   # プロジェクト説明書
```

### 9.2 技術スタック
- **言語**: Python 3.11以上
- **データベース**: PostgreSQL 15（Supabase）
- **キャッシュ**: Redis
- **メール配信**: SendGrid / Amazon SES
- **LLM API**: OpenAI GPT-4 / Claude API
- **監視**: Grafana + Prometheus

## 10. パフォーマンス要件

### 10.1 処理速度目標
- **求人インポート**: 10万件を30分以内
- **スコアリング**: 10万件を45分以内
- **マッチング**: 1万ユーザーを60分以内
- **メール生成**: 1万通を30分以内
- **配信完了**: 1万通を120分以内

### 10.2 システム負荷
- **同時処理**: 8並列処理
- **メモリ使用**: 最大16GB
- **DB接続数**: 最大100接続
- **API呼び出し**: 100リクエスト/秒

## 11. 監視・運用

### 11.1 監視項目
- **バッチ処理**: 実行時間、エラー率、処理件数
- **配信状況**: 送信成功率、開封率、クリック率
- **システム**: CPU使用率、メモリ使用率、DB接続数
- **ビジネス**: 応募率、配信停止率、アクティブユーザー数

### 11.2 アラート設定

| レベル | 条件 | 対応 |
|--------|------|------|
| 緊急 | バッチ処理2時間以上遅延 | 即時対応 |
| 警告 | 配信成功率95%未満 | 1時間以内対応 |
| 注意 | DB接続数90%超過 | 監視強化 |

### 11.3 バックアップ
- **データベース**: 日次フルバックアップ、6時間ごと差分
- **ログ**: 90日間保存後アーカイブ
- **設定**: Git管理によるバージョン管理

## 12. セキュリティ考慮事項

### 12.1 データ保護
- 個人情報の暗号化保存
- メールアドレスのハッシュ化
- アクセスログの定期削除（90日）

### 12.2 アクセス制御
- API認証（JWT）
- レート制限（100リクエスト/分）
- IP制限（本番環境）

### 12.3 監査
- 全操作のログ記録
- 定期的なセキュリティ監査
- 脆弱性診断の実施

## 13. 今後の拡張計画

### Phase 1（現在）
- 基本的なスコアリング・マッチング
- 日次メール配信
- 応募追跡

### Phase 2（3ヶ月後）
- A/Bテスト機能
- プッシュ通知連携
- LINE配信対応

### Phase 3（6ヶ月後）
- リアルタイムマッチング
- AIチャットボット対応
- 企業向けダッシュボード

## 14. 成功指標（KPI）

### 14.1 主要指標
- **応募率**: 配信メールからの応募率5%以上
- **開封率**: 40%以上
- **クリック率**: 15%以上
- **配信継続率**: 3ヶ月後70%以上

### 14.2 サブ指標
- **パーソナライズ精度**: 推薦求人の応募率
- **処理効率**: バッチ処理の完了時間
- **システム稼働率**: 99.9%以上

## 15. 用語集

| 用語 | 説明 |
|------|------|
| エンドクライアント | 実際の求人募集企業 |
| クライアント | 求人媒体・求人代理店 |
| スコア | 求人の魅力度を0-999,999で数値化したもの |
| パーソナライズドスコア | ユーザーの好みを反映した調整後スコア |
| ニーズカテゴリー | ユーザーの働き方ニーズに基づく14分類 |
| 職種カテゴリー | 仕事内容による12分類 |
| 推定活動エリア | 応募履歴から推定されるユーザーの活動地域 |
| 隣接市区町村 | 電車で1-2駅程度の隣接エリア |
| ブースト係数 | スコアを増幅する倍率（1.0-2.0） |

## 16. 開発必須要件（MVP版）

### 16.1 ビジネス面で必須
- **KPI定義**: 「配信メールからの応募クリック率」を測定（目標：5%以上）
- **収益モデル**: 求人掲載企業から応募1件あたり500-20,000円の成果報酬
  - 通常求人：500-1,000円/件
  - プレミアム求人：5,000-20,000円/件

### 16.2 技術面で必須
- **バッチ処理**: 順次実行（並列化なし）でシンプルに構築
- **データベース**: 基本インデックスのみ設定
  - city_cd（市区町村コード）
  - job_id（求人ID）
  - user_id（ユーザーID）
  - created_at, updated_at（日時）

### 16.3 データ品質で必須
- **隣接市区町村**: 東京23区と大阪市内のみ（約200レコード）でスタート
- **カテゴリー分類**: キーワード検出のみ（機械学習モデルなし）
- **SEMRush更新**: 月1回の手動更新で運用（自動化は将来対応）

### 16.4 初回ユーザー対応で必須
- **前提条件**: 初回ユーザーは必ず1件以上の応募データが存在
- **配信開始**: 最初の応募データから即座に配信対象として登録
- **精度向上**: 応募件数が増えるごとに自動的にマッチング精度が向上

### 16.5 監視で必須
- **バッチ処理監視**:
  - エラー発生時：詳細ログをファイル出力
  - Slack通知：処理失敗時に自動通知
  - 監視項目：処理時間、エラー率、完了状況
- **配信監視**:
  - SendGrid/SESのダッシュボードで配信状況確認
  - バウンス率、スパム判定率の定期チェック

### 16.6 MVP版で実装しない機能
以下は初期開発では実装せず、サービス成長後に検討：
- A/Bテスト機能
- ユーザーフィードバック機能
- 配信時間の個別最適化
- 機械学習による分類・スコアリング
- リアルタイム処理
- 複雑なスコアリング調整アルゴリズム

## 17. 実装準備タスク

### 17.1 優先度高
1. **プロジェクト基盤整備**
   - README.md作成（プロジェクト概要、セットアップ手順、ディレクトリ構造説明）
   - .env.exampleファイル作成（Supabase接続情報、APIキー等）
   - プロジェクト構造の整理

2. **バックエンド構築**
   - /backendディレクトリ作成
   - バッチ処理用の基本構造構築（5種類のバッチ処理）
     - データインポートバッチ
     - スコアリングバッチ
     - ユーザーマッピングバッチ
     - メール生成バッチ
     - メール配信バッチ
   - Supabase接続設定

3. **データベース準備**
   - マイグレーションファイル作成（ER図から生成）
   - 隣接市区町村マスターデータ作成（主要都市約500レコード）
   - 初期データ投入スクリプト（/database/seeds/）

### 17.2 優先度中
4. **開発環境整備**
   - Docker環境の完成（PostgreSQL/Supabaseローカル環境）
   - ESLint/Prettier設定（コード品質管理）
   - テスト環境構築（Jest等）

5. **ドキュメント整理**
   - 仕様書の統合・整理
   - API仕様書作成
   - バッチ処理仕様書作成

### 17.3 優先度低
6. **CI/CD構築**
   - GitHub Actions設定（.github/workflows/）
   - 自動テスト・デプロイ設定
   - 環境別設定管理（開発/ステージング/本番）

### 17.4 必要なファイル構造
```
new.mail.score/
├── README.md                    # プロジェクト説明
├── .env.example                 # 環境変数サンプル
├── docker-compose.yml           # Docker設定
├── backend/                     # バックエンド
│   ├── batch/                   # バッチ処理
│   │   ├── import/             # データインポート
│   │   ├── scoring/            # スコアリング
│   │   ├── mapping/            # ユーザーマッピング
│   │   ├── email-generation/   # メール生成
│   │   └── email-delivery/     # メール配信
│   ├── api/                    # API
│   └── lib/                    # 共通ライブラリ
├── database/                    # データベース関連
│   ├── migrations/             # マイグレーション
│   ├── seeds/                  # 初期データ
│   └── data/                   # マスターデータCSV
├── front/                       # フロントエンド（既存）
├── specs/                       # 仕様書（既存）
└── tests/                       # テスト
```

## 18. 改訂履歴

| 版数 | 日付 | 内容 |
|------|------|------|
| v1.0 | 2024-08-XX | 初版作成 |
| v2.0 | 2024-09-XX | パーソナライゼーション機能追加 |
| v3.0 | 2025-01-XX | カテゴリー分類改善、応募ベース配信対応 |
| v3.1 | 2025-01-XX | 隣接市区町村機能追加、複雑機能の簡略化 |
| v3.2 | 2025-09-05 | 実装準備タスク追加 |
| v3.3 | 2025-09-05 | 開発必須要件（MVP版）追加 |

---

**本仕様書に関する問い合わせ先**
- プロジェクト責任者：[担当者名]
- 連絡先：[メールアドレス]
- 最終更新日：2025年1月