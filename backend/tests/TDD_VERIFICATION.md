# TDDæ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ - RED Phaseç¢ºèª

## å¥‘ç´„ãƒ†ã‚¹ãƒˆï¼ˆT005-T013ï¼‰ã®å¤±æ•—ç¢ºèªçµæœ

### å®Ÿè¡Œæ—¥æ™‚: 2025-09-18

## 1. å¥‘ç´„ãƒ†ã‚¹ãƒˆã®ç¾çŠ¶

### T005: POST /batch/trigger
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_batch_trigger.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/batch/trigger`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Foundï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„ï¼‰

### T006: GET /batch/status/{id}
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_batch_status.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/batch/status/{id}`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T007: POST /jobs/import
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_jobs_import.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/jobs/import`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T008: POST /scoring/calculate
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_scoring_calculate.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/scoring/calculate`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T009: POST /matching/generate
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_matching_generate.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/matching/generate`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T010: GET /matching/user/{id}
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_user_matching.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/matching/user/{id}`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T011: POST /email/generate
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_email_generate.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/email/generate`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T012: POST /sql/execute
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_sql_execute.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/sql/execute`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

### T013: GET /monitoring/metrics
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: `tests/contract/test_monitoring_metrics.py`
- **æœŸå¾…ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/api/v1/monitoring/metrics`
- **ç¾çŠ¶**: âŒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæœªå®Ÿè£…
- **å¤±æ•—ç†ç”±**: 404 Not Found

## 2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# å…¨å¥‘ç´„ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œï¼ˆå¤±æ•—ç¢ºèªï¼‰
python -m pytest tests/contract/ -v

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œä¾‹
python -m pytest tests/contract/test_batch_trigger.py::TestBatchTriggerContract::test_trigger_daily_matching_batch -v
```

## 3. æœŸå¾…ã•ã‚Œã‚‹å¤±æ•—å‡ºåŠ›

```
FAILED tests/contract/test_batch_trigger.py::TestBatchTriggerContract::test_trigger_daily_matching_batch
    AssertionError: assert 404 == 202
```

## 4. TDDå®Ÿè£…é †åº

### Phase 1: REDï¼ˆç¾åœ¨ï¼‰âœ…
- ã™ã¹ã¦ã®å¥‘ç´„ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- å¤±æ•—ç†ç”±ï¼šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæœªå®Ÿè£…

### Phase 2: GREENï¼ˆæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æœ€å°å®Ÿè£…ï¼š

1. **T005: /batch/trigger**
   ```python
   @router.post("/trigger", status_code=202)
   async def trigger_batch():
       return {"batch_id": 1, "job_type": "daily_matching", "status": "pending"}
   ```

2. **T006: /batch/status/{id}**
   ```python
   @router.get("/status/{batch_id}")
   async def get_batch_status(batch_id: int):
       return {"batch_id": batch_id, "status": "running", "progress": 50}
   ```

3. **ä»¥é™ã€åŒæ§˜ã«æœ€å°å®Ÿè£…ã‚’è¿½åŠ **

### Phase 3: REFACTORï¼ˆæœ€çµ‚ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿéš›ã®ãƒ­ã‚¸ãƒƒã‚¯ã«ç½®æ›
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

## 5. æ¤œè¨¼åŸºæº–

### RED PhaseæˆåŠŸæ¡ä»¶ âœ…
- [ ] ã™ã¹ã¦ã®å¥‘ç´„ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹
- [ ] å¤±æ•—ç†ç”±ãŒæ˜ç¢ºï¼ˆ404 Not Foundï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰è‡ªä½“ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„

### GREEN PhaseæˆåŠŸæ¡ä»¶
- [ ] ã™ã¹ã¦ã®å¥‘ç´„ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [ ] æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã§å®Ÿè£…
- [ ] ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚‚è¨±å®¹

### REFACTOR PhaseæˆåŠŸæ¡ä»¶
- [ ] å®Ÿéš›ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡é™¤å»
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] è¿½åŠ ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

## 6. ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

**TDDåŸå‰‡ã®é©ç”¨çŠ¶æ³**: ğŸ”´ RED Phase

- ãƒ†ã‚¹ãƒˆã¯å­˜åœ¨ã™ã‚‹ãŒã€å®Ÿè£…ãŒå­˜åœ¨ã—ãªã„ï¼ˆæ­£ã—ã„TDDï¼‰
- ã“ã‚Œã‹ã‚‰æœ€å°å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’ãƒ‘ã‚¹ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
- ãã®å¾Œã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§å“è³ªå‘ä¸Š

---

*ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯TDDåŸå‰‡ã«å¾“ã£ãŸé–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®è¨˜éŒ²ã§ã™*