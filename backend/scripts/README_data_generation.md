# ðŸš€ 10ä¸‡ä»¶æ±‚äººãƒ‡ãƒ¼ã‚¿é«˜é€Ÿç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

PostgreSQLã«10ä¸‡ä»¶ã®ãƒªã‚¢ãƒ«ãªæ±‚äººãƒ‡ãƒ¼ã‚¿ã‚’5åˆ†ä»¥å†…ã§åŠ¹çŽ‡çš„ã«ç”Ÿæˆãƒ»æŠ•å…¥ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ðŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›®æ¨™

- **ç”Ÿæˆé€Ÿåº¦**: 333 records/secï¼ˆ5åˆ†ã§10ä¸‡ä»¶ï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 512MBä»¥ä¸‹
- **ãƒ‡ãƒ¼ã‚¿å“è³ª**: åˆ¶ç´„é•å0ä»¶
- **ã‚¨ãƒ©ãƒ¼çŽ‡**: 0.1%ä»¥ä¸‹

## ðŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆæˆ¦ç•¥
- **ãƒãƒƒãƒå‡¦ç†**: 5,000ä»¶ãšã¤20ãƒãƒƒãƒã«åˆ†å‰²
- **ãƒãƒ«ã‚¯ã‚¤ãƒ³ã‚µãƒ¼ãƒˆ**: PostgreSQL COPY FROMã§é«˜é€ŸæŠ•å…¥
- **ä¸¦åˆ—å‡¦ç†**: 4ãƒ¯ãƒ¼ã‚«ãƒ¼ã§ã®ä¸¦åˆ—å®Ÿè¡Œ
- **ãƒ¡ãƒ¢ãƒªåŠ¹çŽ‡**: ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”Ÿæˆã§ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–

### ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³
- **åœ°åŸŸåˆ†å¸ƒ**: æ±äº¬25%, å¤§é˜ª15%, æ„›çŸ¥8%ï¼ˆäººå£æ¯”ãƒ™ãƒ¼ã‚¹ï¼‰
- **é›‡ç”¨å½¢æ…‹**: ã‚¢ãƒ«ãƒã‚¤ãƒˆ40%, ãƒ‘ãƒ¼ãƒˆ35%, æ´¾é£15%
- **çµ¦ä¸Žåˆ†å¸ƒ**: 900-3000å††ã®ç¾å®Ÿçš„ãªæ™‚çµ¦åˆ†å¸ƒ
- **feeåˆ†å¸ƒ**: 500-5000å††ï¼ˆåˆ¶ç´„æ¡ä»¶æº€ãŸã™ï¼‰

## ðŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
scripts/
â”œâ”€â”€ generate_job_data.py           # ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ setup_master_data.py           # ãƒžã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿äº‹å‰æŠ•å…¥
â”œâ”€â”€ benchmark_data_generation.py   # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æ¤œè¨¼
â”œâ”€â”€ run_data_generation.sh         # çµ±åˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ requirements_data_generation.txt # Pythonä¾å­˜é–¢ä¿‚
â””â”€â”€ README_data_generation.md      # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ðŸ”§ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Pythonä»®æƒ³ç’°å¢ƒä½œæˆ
python3 -m venv venv
source venv/bin/activate

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r scripts/requirements_data_generation.txt
```

### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .env.dev ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
cat > .env.dev << 'EOF'
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mail_score_dev
DB_USER=postgres
DB_PASSWORD=password
EOF
```

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æº–å‚™

```bash
# ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆæ—¢ã«ã‚¹ã‚­ãƒ¼ãƒžä½œæˆæ¸ˆã¿ã®å ´åˆï¼‰
psql -h localhost -U postgres -d mail_score_dev -f migrations/001_initial_schema.sql
```

## ðŸš€ å®Ÿè¡Œæ–¹æ³•

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆæŽ¨å¥¨ï¼‰

```bash
# çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ä¸€æ‹¬å®Ÿè¡Œ
./scripts/run_data_generation.sh dev 100000

# ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯ä»˜ãå®Ÿè¡Œ
./scripts/run_data_generation.sh dev 100000 --benchmark
```

### å€‹åˆ¥å®Ÿè¡Œ

```bash
# 1. ãƒžã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
python3 scripts/setup_master_data.py

# 2. æ±‚äººãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
python3 scripts/generate_job_data.py

# 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æ¤œè¨¼
python3 scripts/benchmark_data_generation.py
```

## ðŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–

### ãƒãƒƒãƒå‡¦ç†è¨­å®š

```python
BATCH_CONFIG = {
    'batch_size': 5000,        # æœ€é©ãƒãƒƒãƒã‚µã‚¤ã‚º
    'parallel_workers': 4,     # CPUä¸¦åˆ—åº¦
    'use_copy_from': True,     # PostgreSQL COPYä½¿ç”¨
    'memory_limit_mb': 512,    # ãƒ¡ãƒ¢ãƒªåˆ¶é™
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

```sql
-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸€æ™‚ç„¡åŠ¹åŒ–ï¼ˆç”Ÿæˆä¸­ï¼‰
DROP INDEX CONCURRENTLY idx_jobs_location;

-- ç”Ÿæˆå¾Œã«å†ä½œæˆ
CREATE INDEX CONCURRENTLY idx_jobs_location ON jobs(pref_cd, city_cd, is_active);
```

## ðŸŽ¯ ãƒ‡ãƒ¼ã‚¿å“è³ªä¿è¨¼

### åˆ¶ç´„ãƒã‚§ãƒƒã‚¯

- **feeåˆ¶ç´„**: fee > 500 AND fee <= 5000
- **å¤–éƒ¨ã‚­ãƒ¼**: prefecture_master, city_masterå‚ç…§æ•´åˆæ€§
- **å¿…é ˆé …ç›®**: endcl_cd, company_name, application_nameç­‰
- **ç”Ÿæˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: has_high_incomeç­‰ã®è‡ªå‹•è¨ˆç®—

### åˆ†å¸ƒæ¤œè¨¼

```sql
-- åœ°åŸŸåˆ†å¸ƒç¢ºèª
SELECT pref_cd, COUNT(*)
FROM jobs
GROUP BY pref_cd
ORDER BY COUNT(*) DESC;

-- çµ¦ä¸Žåˆ†å¸ƒç¢ºèª
SELECT
    CASE
        WHEN min_salary < 1200 THEN 'åŸºæœ¬æ™‚çµ¦'
        WHEN min_salary < 1500 THEN 'æ¨™æº–æ™‚çµ¦'
        WHEN min_salary < 2000 THEN 'é«˜æ™‚çµ¦'
        ELSE 'ç‰¹åˆ¥é«˜æ™‚çµ¦'
    END as salary_range,
    COUNT(*)
FROM jobs
GROUP BY 1;
```

## ðŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

```
logs/
â”œâ”€â”€ data_generation_dev_20250918_143022.log  # å®Ÿè¡Œãƒ­ã‚°
â”œâ”€â”€ jobs_backup_20250918_143022.sql          # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆæœ¬ç•ªã®ã¿ï¼‰
â””â”€â”€ /tmp/benchmark_results/                  # ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯çµæžœ
    â”œâ”€â”€ benchmark_results.csv
    â”œâ”€â”€ benchmark_summary.md
    â””â”€â”€ performance_charts.png
```

### é€²æ—ç›£è¦–

```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ç¢ºèª
tail -f logs/data_generation_dev_*.log

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›£è¦–
top -p $(pgrep -f generate_job_data.py)
```

## ðŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ãƒ¡ãƒ¢ãƒªä¸è¶³
```
ERROR: out of memory
```
**è§£æ±ºç­–**: batch_sizeã‚’3000ã«å‰Šæ¸›

#### 2. æŽ¥ç¶šã‚¨ãƒ©ãƒ¼
```
ERROR: could not connect to server
```
**è§£æ±ºç­–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šãƒ»æŽ¥ç¶šæƒ…å ±ç¢ºèª

#### 3. åˆ¶ç´„é•å
```
ERROR: new row for relation "jobs" violates check constraint
```
**è§£æ±ºç­–**: ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã®feeç¯„å›²ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æ”¹å–„

#### é€Ÿåº¦å‘ä¸Š
1. **batch_sizeå¢—åŠ **: 5000 â†’ 7500
2. **ä¸¦åˆ—åº¦èª¿æ•´**: CPUæ•°ã«å¿œã˜ã¦2-8
3. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç„¡åŠ¹åŒ–**: ç”Ÿæˆä¸­ã¯æœ€å°é™ã«

#### ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–
1. **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”Ÿæˆ**: ãƒãƒƒãƒã”ã¨ã«è§£æ”¾
2. **æŽ¥ç¶šãƒ—ãƒ¼ãƒ«**: åŒä¸€æŽ¥ç¶šã®å†åˆ©ç”¨
3. **ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**: æ˜Žç¤ºçš„ãªãƒ¡ãƒ¢ãƒªè§£æ”¾

## ðŸŽª ä½¿ç”¨ä¾‹

### é–‹ç™ºç’°å¢ƒï¼ˆ1ä¸‡ä»¶ãƒ†ã‚¹ãƒˆï¼‰

```bash
./scripts/run_data_generation.sh dev 10000
```

### ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒï¼ˆ5ä¸‡ä»¶ï¼‰

```bash
./scripts/run_data_generation.sh staging 50000
```

### æœ¬ç•ªç’°å¢ƒï¼ˆ10ä¸‡ä»¶ï¼‰

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä»˜ãæœ¬ç•ªå®Ÿè¡Œ
./scripts/run_data_generation.sh production 100000
```

## ðŸ“ ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚º

### ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒå¤‰æ›´

```python
# generate_job_data.py å†…
'prefecture_weights': {
    '13': 30.0,  # æ±äº¬éƒ½ã‚’30%ã«å¤‰æ›´
    '27': 20.0,  # å¤§é˜ªåºœã‚’20%ã«å¤‰æ›´
    # ...
}
```

### æ–°ã—ã„ç‰¹å¾´è¿½åŠ 

```python
# feature_master ã«æ–°ç‰¹å¾´è¿½åŠ å¾Œ
'feature_probabilities': {
    'D01': 0.35,  # æ—¥æ‰•ã„
    'NEW01': 0.25,  # æ–°ç‰¹å¾´
    # ...
}
```

## ðŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»é‹ç”¨

### æœ¬ç•ªç’°å¢ƒå®Ÿè¡Œæ™‚ã®æ³¨æ„
- **ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è‡ªå‹•å®Ÿè¡Œ
- **å®Ÿè¡Œç¢ºèª**: å¯¾è©±çš„ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**: å¤±æ•—æ™‚ã®å¾©æ—§æ‰‹é †

### ç›£æŸ»ãƒ­ã‚°
- **å®Ÿè¡Œè€…è¨˜éŒ²**: å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»æ™‚åˆ»
- **å¤‰æ›´è¿½è·¡**: å½±éŸ¿ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°
- **å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹**: åˆ¶ç´„é•åãƒ»ã‚¨ãƒ©ãƒ¼æ•°

## ðŸ“ž ã‚µãƒãƒ¼ãƒˆ

### å•é¡Œå ±å‘Š
- **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«**: å¿…é ˆæ·»ä»˜
- **ç’°å¢ƒæƒ…å ±**: OS, PostgreSQLç‰ˆæœ¬
- **å®Ÿè¡Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã€ãƒãƒƒãƒã‚µã‚¤ã‚º

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ç›¸è«‡
- **ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯çµæžœ**: CSVãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ·»ä»˜
- **ãƒªã‚½ãƒ¼ã‚¹åˆ¶ç´„**: CPUã€ãƒ¡ãƒ¢ãƒªä»•æ§˜
- **ç›®æ¨™è¨­å®š**: è¦æ±‚é€Ÿåº¦ãƒ»åˆ¶ç´„æ¡ä»¶